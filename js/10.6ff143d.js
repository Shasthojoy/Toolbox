(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{"595n":function(e,t,i){"use strict";var s=i("gTBB"),a=i.n(s);a.a},I6O0:function(e,t,i){},JqPQ:function(e,t,i){},ccs6:function(e,t,i){"use strict";var s=i("JqPQ"),a=i.n(s);a.a},d2yj:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.active?[i("q-toolbar",{staticClass:"justify-between",attrs:{slot:"header",color:"dark"},slot:"header"},[i("q-item",{staticClass:"no-padding",staticStyle:{"max-width":"50%"},style:{cursor:e.isNeedSelect?"":"default!important"}},[i("q-item-main",[i("q-item-tile",{staticClass:"ellipsis overflow-hidden",style:{maxWidth:"140px"},attrs:{label:""}},[e._v(e._s(e.selectedItem.name||"#"+e.selectedItem.id))]),e.selectedItem.ident?i("q-item-tile",{staticStyle:{"font-size":"0.8rem"},attrs:{sublabel:""}},[e._v(e._s(e.selectedItem.ident))]):e._e()],1),i("q-item-side",{staticClass:"text-right"},[i("q-item-tile",{staticClass:"text-center",staticStyle:{display:"inline-block"},attrs:{stamp:"",color:"white"}},[e.selectedItem.deleted?i("div",{staticClass:"cheap-modifier"},[i("small",[e._v("DELETED")])]):e._e(),e._v("#"+e._s(e.selectedItem.id.toString()))]),e.isNeedSelect?i("q-item-tile",{staticStyle:{display:"inline-block"},attrs:{stamp:"",color:"white",size:"2rem",icon:"mdi-menu-down"}}):e._e()],1),e.isNeedSelect?i("q-popover",{ref:"popoverActive",attrs:{fit:""}},[i("q-list",{staticClass:"scroll",attrs:{link:"",separator:""}},[i("VirtualList",{attrs:{size:56,remain:e.items.length>6?6:e.items.length}},e._l(e.items,function(t,s){return i("q-item",{key:s,staticClass:"cursor-pointer",class:{"text-grey-8":t.deleted},attrs:{highlight:""},nativeOn:{click:function(i){e.active=t.id,e.$refs.popoverActive.hide(),e.$emit("view-data-hide")}}},[i("q-item-main",[i("q-item-tile",{staticClass:"ellipsis overflow-hidden",style:{maxWidth:e.$q.platform.is.mobile?"":"140px"},attrs:{label:""}},[e._v(e._s(t.name||"#"+t.id))]),i("q-item-tile",{attrs:{sublabel:""}},[i("small",[e._v(e._s(t.ident||"<no ident>"))])])],1),i("q-item-side",{staticClass:"text-center"},[t.deleted?i("q-item-tile",{staticClass:"cheap-modifier"},[i("small",[e._v("DELETED")])]):e._e(),i("q-item-tile",[i("small",[e._v("#"+e._s(t.id.toString()))])])],1)],1)}))],1),e.needShowGetDeletedAction&&1===e.tokenType?i("q-btn",{staticClass:"deleted-action",attrs:{icon:"mdi-download"},on:{click:e.getDeletedHandler}},[e._v("get deleted")]):e._e()],1):e._e()],1),e.selectedItem.deleted?e._e():i("q-btn",{staticClass:"on-left",attrs:{flat:"",color:"white",icon:e.modeModel?"playlist_play":"history",rounded:e.$q.platform.is.mobile},on:{click:function(t){e.modeModel=!e.modeModel}}},[i("q-tooltip",[e._v("Mode (Real-time/History)")]),e._v("\n        "+e._s(e.$q.platform.is.mobile?"":e.modeModel?"Real-time":"History")+"\n        "),e.newMessagesCount?i("q-chip",{staticClass:"cursor-pointer q-ml-sm",attrs:{small:"",square:"",color:"red"}},[e._v(e._s(e.newMessagesCount))]):e._e()],1),i("div",[e.messagesWithPosition.length&&e.$q.platform.is.desktop?i("q-icon",{staticClass:"on-left cursor-pointer pull-right",attrs:{size:"1.5rem",name:"mdi-map"},nativeOn:{click:function(t){e.isVisibleMap=!e.isVisibleMap}}},[i("q-tooltip",[e._v("Map")])],1):e._e(),e.modeModel&&!e.isEmptyMessages?i("q-icon",{staticClass:"on-left cursor-pointer pull-right",attrs:{size:"1.5rem",color:"white",name:"mdi-playlist-remove"},nativeOn:{click:function(t){return e.clearHandler(t)}}},[i("q-tooltip",[e._v("Clear all panes")])],1):e._e(),e.selectedItem.deleted?e._e():i("q-icon",{staticClass:"cursor-pointer pull-right",attrs:{size:"1.5rem",name:"mdi-format-align-middle"}},[i("q-tooltip",[e._v("Section ratio")]),i("q-popover",{ref:"ratioPopover"},[i("q-item",{staticClass:"bg-dark",staticStyle:{width:"25rem",height:"100px"}},[i("q-item-side",{staticClass:"text-center"},[i("q-item-tile",{attrs:{color:"grey-6"}},[e._v("Logs")])],1),i("q-item-main",[i("q-item-tile",{staticClass:"ellipsis overflow-hidden",attrs:{label:"",color:"white"}},[e._v("Ratio")]),i("q-item-tile",{attrs:{sublabel:""}},[i("q-slider",{attrs:{color:"grey-6",min:0,max:100,step:25,label:"",snap:""},model:{value:e.ratio,callback:function(t){e.ratio=t},expression:"ratio"}})],1)],1),i("q-item-side",{staticClass:"text-center",attrs:{right:""}},[i("q-item-tile",{attrs:{color:"grey-6"}},[e._v("Messages")])],1)],1)],1)],1)],1)],1),i("div",[+e.size[0]?i("logs",{ref:"logs",style:[{minHeight:"calc("+e.size[0]+"vh - "+(+e.size[1]?e.isVisibleToolbar?"50px":"25px":e.isVisibleToolbar?"100px":"50px")+")",position:"relative"},{maxWidth:e.mapMinimizedOptions.value&&e.mapMinimizedOptions.type&&"logs"===e.mapMinimizedOptions.type?"66%":""}],attrs:{mode:e.mode,item:e.selectedItem,limit:e.limit,originPattern:"gw/devices/:id",isEnabled:!!+e.size[0],config:e.config.logs},on:{"view-log-message":e.viewLogMessagesHandler}}):e._e(),+e.size[1]?i("messages",{ref:"messages",style:[{minHeight:"calc("+e.size[1]+"vh - "+(+e.size[0]?e.isVisibleToolbar?"50px":"25px":e.isVisibleToolbar?"100px":"50px")+")",position:"relative"},{maxWidth:e.mapMinimizedOptions.value&&e.mapMinimizedOptions.type&&"messages"===e.mapMinimizedOptions.type?"66%":""}],attrs:{mode:e.mode,item:e.selectedItem,activeId:e.active,isEnabled:!!+e.size[1],limit:e.limit,config:e.config.messages},on:{"view-data":e.viewDataHandler}}):e._e()],1),e.active&&e.messagesWithPosition.length&&e.$q.platform.is.desktop&&e.isVisibleMap?i("map-component",{ref:"map",attrs:{messages:e.messagesWithPosition,device:e.selectedItem,siblingHeight:e.siblingHeight},on:{"map:close":function(t){e.isVisibleMap=!1},"map:minimize":e.mapMinimizeHandler}}):e._e(),e.selectedItem.deleted?i("div",{staticClass:"text-center",staticStyle:{"font-size":"1.5rem","margin-top":"30px",color:"white"}},[e._v("Nothing to show by device «"+e._s(e.selectedItem.name||"#"+e.selectedItem.id)+"» "),i("div",{staticStyle:{"font-size":"0.9rem"}},[e._v("or you haven`t access")])]):e._e()]:i("div",{staticClass:"text-center",staticStyle:{display:"flex","justify-content":"center","font-size":"1.5rem"}},[i("div",{staticClass:"text-grey-3",staticStyle:{"margin-top":"50px"}},[e.items.length?i("q-btn",{staticStyle:{display:"flex","flex-wrap":"nowrap","margin-top":"20px"},attrs:{flat:"","icon-right":"mdi-menu-down"}},[e._v("\n        Select device\n        "),i("q-popover",{ref:"popoverNotActive",attrs:{fit:""}},[i("q-list",{staticClass:"scroll",attrs:{link:"",separator:""}},[i("VirtualList",{attrs:{size:56,remain:e.items.length>6?6:e.items.length}},e._l(e.items,function(t,s){return i("q-item",{key:s,staticClass:"cursor-pointer",class:{"text-grey-8":t.deleted},attrs:{highlight:""},nativeOn:{click:function(i){e.active=t.id,e.$refs.popoverNotActive.hide()}}},[i("q-item-main",[i("q-item-tile",{staticClass:"ellipsis overflow-hidden",style:{maxWidth:e.$q.platform.is.mobile?"":"140px"},attrs:{label:""}},[e._v(e._s(t.name||"#"+t.id)),e.$q.platform.is.desktop&&t.name?i("q-tooltip",[e._v(e._s(t.name))]):e._e()],1),i("q-item-tile",{attrs:{sublabel:""}},[i("small",[e._v(e._s(t.ident||"<no ident>"))])])],1),i("q-item-side",{staticClass:"text-center"},[t.deleted?i("q-item-tile",{staticClass:"cheap-modifier"},[i("small",[e._v("DELETED")])]):e._e(),i("q-item-tile",[i("small",[e._v("#"+e._s(t.id.toString()))])])],1)],1)}))],1),e.needShowGetDeletedAction&&1===e.tokenType?i("q-btn",{staticClass:"deleted-action",attrs:{icon:"mdi-download"},on:{click:e.getDeletedHandler}},[e._v("get deleted")]):e._e()],1)],1):e._e(),e.items.length?e._e():i("div",[e._v(e._s(e.isLoading?"Fetching data..":"Devices not found"))])],1)])],2)},a=[],n=(i("ls82"),i("yXPU")),o=i.n(n),r=(i("xfY5"),i("MVZn")),l=i.n(r),c=i("LOAh"),m=i("jVSR"),d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("vue-draggable-resizable",{ref:"dragResize",staticClass:"map-component__wrapper",class:[e.isMapMinimized||e.isMapMaximized?"map-component--minimized":""],style:e.wrapperStyles,attrs:{active:!0,x:e.startX,y:e.startY,w:e.width,h:e.height,minw:100,minh:100,parent:!0},on:{resizing:e.mapResizeHandler,dragging:e.draggingHandler}},[i("q-window-resize-observable",{on:{resize:e.onWindowResize}}),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isMapMinimized&&!e.isMapMaximized,expression:"!isMapMinimized && !isMapMaximized"}],staticClass:"map-container__header",style:{height:e.headerMapHeight+"px"}},[i("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:"mdi-close",color:"white"},nativeOn:{mousedown:function(t){return t.stopPropagation(),t.preventDefault(),e.closeMapHandler(t)}}}),i("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:e.isMapMaximized?"mdi-fullscreen-exit":"mdi-fullscreen",color:"white"},nativeOn:{mousedown:function(t){return t.stopPropagation(),t.preventDefault(),e.maximizeHandler(t)}}}),i("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:"mdi-arrow-bottom-right",color:"white"},nativeOn:{mousedown:function(t){t.stopPropagation(),t.preventDefault(),e.minimizeHandler("messages")}}}),i("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:"mdi-arrow-top-right",color:"white"},nativeOn:{mousedown:function(t){t.stopPropagation(),t.preventDefault(),e.minimizeHandler("logs")}}})],1),i("div",{style:e.mapStyles,attrs:{id:"map"}},[i("q-resize-observable",{on:{resize:e.onResize}})],1),e.isMapMinimized||e.isMapMaximized?i("div",{staticClass:"map-component__custom-controls"},[i("q-icon",{staticClass:"pull-right cursor-pointer",attrs:{name:"mdi-close",size:"30px",color:"dark"},nativeOn:{mousedown:function(t){return t.stopPropagation(),t.preventDefault(),e.closeMapHandler(t)}}}),e.isMapMinimized?i("q-icon",{staticClass:"pull-right cursor-pointer",attrs:{name:"mdi-window-restore",size:"30px",color:"dark"},nativeOn:{mousedown:function(t){return t.stopPropagation(),t.preventDefault(),e.restoreHandler(t)}}}):e._e(),e.isMapMaximized?i("q-icon",{staticClass:"pull-right cursor-pointer",attrs:{name:e.isMapMaximized?"mdi-fullscreen-exit":"mdi-fullscreen",size:"30px",color:"dark"},nativeOn:{mousedown:function(t){return t.stopPropagation(),t.preventDefault(),e.maximizeHandler(t)}}}):e._e()],1):e._e()],1)},h=[],u=(i("f3/d"),i("4R65")),p=(i("bMVF"),i("hRwt")),g=i.n(p),f={name:"map-component",props:["messages","device","siblingHeight"],data:function(){return{map:null,marker:null,track:null,zoom:10,color:"#037be3",height:520,width:500,prevWidth:0,prevHeight:0,headerMapHeight:20,startX:50,startY:50,isMapMinimized:!1,isMapMaximized:!1,minimizeTo:"",winWidth:0,winHeight:0}},computed:{mapStyles:function(){if(this.device&&this.messages&&this.messages.length)return{width:"".concat(this.width,"px"),height:"".concat(this.height-(this.isMapMinimized||this.isMapMaximized?0:this.headerMapHeight),"px")}},wrapperStyles:function(){if(this.device&&this.messages&&this.messages.length)return{width:"".concat(this.width,"px"),height:"".concat(this.height,"px"),position:"absolute",backgroundColor:"#666"}}},methods:{initMap:function(){var e=this;if(!this.map){var t=this.messages.length?this.messages[this.messages.length-1]:{},i=t["position.latitude"]&&t["position.longitude"]?[t["position.latitude"],t["position.longitude"]]:[51.50853,-.12574];this.map=u["map"]("map",{center:i,zoom:this.zoom,maxBounds:[[90,-180],[-90,180]]}),this.map.addEventListener("zoom",function(t){e.zoom=t.target.getZoom()}),this.map.addEventListener("mousedown",function(e){e.originalEvent.stopPropagation()}),u["tileLayer"]("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:3,noWrap:!0}).addTo(this.map)}},flyTo:function(e){this.map.flyTo(e)},closeMapHandler:function(){this.$emit("map:close"),this.isMapMinimized&&(this.$emit("map:minimize",{value:!1}),this.minimizeTo="",this.isMapMinimized=!1),this.isMapMaximized&&(this.isMapMaximized=!1)},maximizeHandler:function(){this.isMapMaximized?(this.width=this.prevWidth,this.height=this.prevHeight,this.isMapMaximized=!1):(this.prevWidth=this.width,this.prevHeight=this.height,this.maximize())},minimizeHandler:function(e){this.$emit("map:minimize",{type:e,value:!0}),this.prevWidth=this.width,this.prevHeight=this.height,this.isMapMinimized=!0,this.minimizeTo=e,this.isMapMaximized&&(this.isMapMaximized=!1)},restoreHandler:function(){this.$emit("map:minimize",{value:!0}),this.isMapMinimized=!1,this.minimizeTo="",this.$refs.dragResize.left=50,this.$refs.dragResize.top=50},minimize:function(e){var t=this,i=parseInt(this.$el.parentNode.clientWidth,10),s=parseInt(this.$el.parentNode.clientHeight,10);switch(this.width=.34*i,this.height=s*(this.siblingHeight/100)-25,e){case"messages":this.$nextTick(function(){t.$refs.dragResize.left=.66*i,t.$refs.dragResize.top=t.height+50});break;case"logs":this.$nextTick(function(){t.$refs.dragResize.left=.66*i,t.$refs.dragResize.top=50})}},maximize:function(){var e=this,t=parseInt(this.$el.parentNode.clientWidth,10)-1,i=parseInt(this.$el.parentNode.clientHeight,10);this.width=t,this.height=i,this.$nextTick(function(){e.$refs.dragResize.left=0,e.$refs.dragResize.top=0}),this.isMapMinimized&&(this.$emit("map:minimize",{value:!1}),this.minimizeTo="",this.isMapMinimized=!1),this.isMapMaximized=!0},mapResizeHandler:function(e,t,i,s){this.width=i,this.height=s},generateIcon:function(){return u["divIcon"]({className:"my-div-icon icon-".concat(this.device.id),iconSize:new u["Point"](20,20),html:'<div style="border-color: '.concat(this.color,"; transform: rotate(").concat((this.messages[this.messages.length-1]["position.direction"]||0)-45,'deg)" class="my-div-icon__inner"></div><div class="my-div-icon__name">').concat(this.device.name,"</div>")})},onResize:function(){this.map&&this.map.invalidateSize()},onWindowResize:function(e){if(this.onResize(),this.isMapMinimized)this.minimizeHandler(this.minimizeTo),this.minimize(this.minimizeTo);else if(this.isMapMaximized)this.maximize();else{if(this.winWidth>e.width){var t=this.$refs.dragResize.left,i=this.winWidth-e.width;t+this.width>=this.winWidth-30&&(t&&(t-=i,t<0&&(i=-1*t,t=0),this.$refs.dragResize.left=t),0===t&&(this.$refs.dragResize.width-=i,this.width-=i,this.width<100&&(this.$refs.dragResize.width=100,this.width=100)))}if(this.winHeight>e.height){var s=this.$refs.dragResize.top,a=this.winHeight-e.height;s+this.height>=this.winHeight-30&&(s&&(s-=a,s<0&&(a=-1*s,s=0),this.$refs.dragResize.top=s),0===s&&(this.$refs.dragResize.height-=a,this.height-=a,this.height<100&&(this.$refs.dragResize.height=100,this.height=100)))}this.winHeight=document.documentElement.clientHeight,this.winWidth=document.documentElement.clientWidth}},draggingHandler:function(){this.isMapMinimized&&(this.$emit("map:minimize",{value:!1}),this.minimizeTo="",this.isMapMinimized=!1),this.isMapMaximized&&(this.isMapMaximized=!1)},getLatLngArr:function(){return this.messages.reduce(function(e,t){return e.push([t["position.latitude"],t["position.longitude"]]),e},[])},updateMarkerHandler:function(e){var t=e.lastPos;this.marker&&this.marker.setLatLng(t).update()},initMarker:function(){var e=this,t=this.messages[this.messages.length-1],i=[t["position.latitude"],t["position.longitude"]];this.marker=u["marker"](i,{icon:this.generateIcon(),title:this.device.name}),this.marker.addEventListener("move",function(t){e.marker.setIcon(e.generateIcon()),e.marker.update()}),this.marker.addTo(this.map)},initDeviceOnMap:function(){this.initMarker(),this.track=u["polyline"](this.getLatLngArr(),{color:this.color}).addTo(this.map)},updateDeviceOnMap:function(){var e=this.getLatLngArr(),t=this.marker&&this.marker instanceof u["Marker"]?this.marker.getLatLng():{},i=this.messages&&this.messages.length&&t.lat&&t.lat!==this.messages[this.messages.length-1]["position.latitude"]&&t.lng&&t.lng!==this.messages[this.messages.length-1]["position.longitude"];i&&this.map.flyTo(e[this.messages.length-1],this.zoom),this.messages.length&&(this.marker instanceof u["Marker"]||this.initMarker(),this.track instanceof u["Polyline"]||(this.track=u["polyline"](this.getLatLngArr(),{color:this.color}).addTo(this.map))),this.marker.setLatLng(e[this.messages.length-1]).update(),this.marker.setOpacity(1),this.track.setLatLngs(e)}},mounted:function(){this.initMap(),this.initDeviceOnMap(),this.winHeight=document.documentElement.clientHeight,this.winWidth=document.documentElement.clientWidth},watch:{messages:function(e){this.updateDeviceOnMap()},minimizeTo:function(e){e?this.minimize(e):(this.width=this.prevWidth,this.height=this.prevHeight)}},components:{VueDraggableResizable:g.a}},v=f,x=(i("uuwW"),i("KHd+")),M=Object(x["a"])(v,d,h,!1,null,null,null),w=M.exports,z=i("L2JU"),$=i("lf+j"),y=i.n($),b={props:["limit","isLoading","isVisibleToolbar","isNeedSelect","config"],data:function(){return{mode:1,active:null,ratio:50,isInit:!1,isVisibleMap:!1,mapMinimizedOptions:{},siblingHeight:null,needShowGetDeletedAction:!0}},computed:l()({},Object(z["d"])({newMessagesCount:function(e){var t=this.config.messages&&e[this.config.messages.vuexModuleName]?e[this.config.messages.vuexModuleName].newMessagesCount:0,i=this.config.logs&&e[this.config.logs.vuexModuleName]?e[this.config.logs.vuexModuleName].newMessagesCount:0;return t+i},isEmptyMessages:function(e){var t=this.config.messages&&e[this.config.messages.vuexModuleName]&&!e[this.config.messages.vuexModuleName].messages.length&&100!==this.ratio,i=this.config.logs&&e[this.config.logs.vuexModuleName]&&e[this.config.logs.vuexModuleName].messages&&!e[this.config.logs.vuexModuleName].messages.length&&0!==this.ratio;return t&&i},tokenType:function(e){return e.tokenInfo.access?e.tokenInfo.access.type:-1}}),{size:function(){return[this.ratio,100-this.ratio]},messagesWithPosition:function(){return this.config&&this.config.messages&&this.$store.state[this.config.messages.vuexModuleName]?this.$store.state[this.config.messages.vuexModuleName].messages.filter(function(e){return!!e["position.latitude"]&&!!e["position.longitude"]}):[]},items:function(){return this.$store.state.items},selectedItem:function(){var e=this;return this.items.filter(function(t){return t.id===e.active})[0]||{}},modeModel:{get:function(){return!!this.mode},set:function(e){var t=Date.now();this.date=e?0:t-t%864e5,this.mode=Number(e),this.$emit("view-data-hide")}}}),methods:l()({},Object(z["b"])(["getDeleted"]),{viewDataHandler:function(e){this.$emit("view-data",e),this.isVisibleMap&&e["position.latitude"]&&e["position.longitude"]&&this.$refs.map.flyTo([e["position.latitude"],e["position.longitude"]])},viewLogMessagesHandler:function(e){this.$emit("view-log-message",e)},unselect:function(){this.$refs.messages.unselect()},mapMinimizeHandler:function(e){this.mapMinimizedOptions=e,"messages"===e.type?this.siblingHeight=this.size[1]:"logs"===e.type?this.siblingHeight=this.size[0]:this.siblingHeight=null},clearHandler:function(){var e=this;this.$q.dialog({title:"Confirm",message:"Do you really want to clear all data from the panes?",ok:!0,cancel:!0}).then(function(){e.$store.commit("".concat(e.config.messages.vuexModuleName,"/clearMessages")),e.$store.commit("".concat(e.config.logs.vuexModuleName,"/clearMessages"))}).catch(function(){})},getDeletedHandler:function(){var e=o()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getDeleted("devices");case 2:this.needShowGetDeletedAction=!1;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}),created:function(){var e=this,t=this.$q.localStorage.get.item("devices");this.$store.dispatch("getItems","devices").then(function(){e.isInit=!0,e.$route.params&&e.$route.params.id?e.items.filter(function(t){return t.id===Number(e.$route.params.id)}).length?e.active=Number(e.$route.params.id):e.active=null:t&&e.items.filter(function(e){return e.id===t}).length&&(e.active=t),e.selectedItem.deleted&&(e.mode=0,e.ratio=100)})},destroyed:function(){this.$store.commit("clearItems")},watch:{ratio:function(e){var t=this;this.$nextTick(function(){+t.size[0]&&t.active&&(t.$refs.logs.resetParams(),t.$emit("view-data-hide")),+t.size[1]&&t.active&&t.$refs.messages.resetParams()})},$route:function(e){e.params&&e.params.id?this.items.filter(function(t){return t.id===Number(e.params.id)}).length?this.active=Number(e.params.id):this.isInit&&(this.active=null):e.params&&!e.params.id&&(this.active=null)},active:function(e){var t=this.items.filter(function(t){return t.id===e})[0]||{};e?(this.$q.localStorage.set("devices",e),this.$router.push("/devices/".concat(e))):this.$router.push("/devices"),t.deleted?(this.ratio=100,this.mode=0):this.ratio=t.deleted?100:50}},components:{logs:c["default"],messages:m["default"],MapComponent:w,VirtualList:y.a}},_=b,N=(i("595n"),Object(x["a"])(_,s,a,!1,null,null,null));t["default"]=N.exports},gTBB:function(e,t,i){},jVSR:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("virtual-scroll-list",{ref:"scrollList",attrs:{cols:e.cols,actions:e.actions,items:e.messages,date:e.from,mode:e.mode,viewConfig:e.viewConfig,colsConfigurator:"toolbar",i18n:e.i18n,filter:e.filter,theme:e.theme,title:"Messages"},on:{"change:filter":e.filterChangeHandler,"change:pagination-prev":e.paginationPrevChangeHandler,"change:pagination-next":e.paginationNextChangeHandler,"change:date":e.dateChangeHandler,"change:date-prev":e.datePrevChangeHandler,"change:date-next":e.dateNextChangeHandler,"change:mode":e.modeChange,"update:cols":e.updateColsHandler},scopedSlots:e._u([{key:"items",fn:function(t){var s=t.item,a=t.index,n=t.actions,o=t.cols,r=t.etcVisible,l=t.actionsVisible,c=t.itemHeight,m=t.rowWidth;return i("messages-list-item",{key:""+JSON.stringify(s)+a,attrs:{item:s,index:a,actions:n,cols:o,itemHeight:c,rowWidth:m,etcVisible:r,actionsVisible:l,selected:a===e.selected},on:{action:e.actionHandler,"item-click":e.viewMessagesHandler}})}}])})],1)},a=[],n=(i("ls82"),i("yXPU")),o=i.n(n),r=i("3kWr"),l=i("Kw5r"),c=i("9JDm"),m=i("75Vb"),d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px"}},[e.item["__connectionStatus"]||e.item["x-flespi-filter-prev"]||e.item["x-flespi-filter-next"]?e.item["x-flespi-filter-prev"]||e.item["x-flespi-filter-next"]?i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px",color:"#000",fontWeight:"bold",backgroundColor:e.item["x-flespi-filter-prev"]?"#819002":"#ccb300",overflow:"hidden"}},[i("span",{staticClass:"uppercase text-white",staticStyle:{padding:"0 5px"}},[e._v(e._s(e.item["x-flespi-filter-next"]?'Next results will be filtered by: "'+e.item["x-flespi-filter-next"]+'"':'Filter removed: "'+e.item["x-flespi-filter-prev"]+'"'))])]):i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px",border:"solid 1px #000",color:"#000",fontWeight:"bold",backgroundColor:"offline"===e.item.__connectionStatus?"#ff0":"#0f0",backgroundImage:"url(./statics/police.png)",overflow:"hidden",opacity:".7"},attrs:{title:e.date.formatDate(1e3*e.item.timestamp,"DD/MM/YYYY HH:mm:ss")}},e._l(Array(10),function(t){return i("span",{key:t,staticClass:"uppercase",staticStyle:{padding:"0 5px","margin-left":"150px"},style:{backgroundColor:"offline"===e.item.__connectionStatus?"#ff0":"#0f0"}},[e._v("\n    "+e._s(e.item["__connectionStatus"])+"\n  ")])})):i("div",{staticClass:"cursor-pointer",class:[e.item.__status?"missed-items":""],style:{height:e.itemHeight+"px",width:e.rowWidth+"px",backgroundColor:e.selected?"rgba(255,255,255,0.7)":"",color:e.selected?"#333":"",borderBottom:e.item.delimiter?"solid 1px #f40":""},on:{click:function(t){e.itemClickHandler(e.index,e.item)}}},[e.actionsVisible?i("span",{staticClass:"list__item item_actions"},e._l(e.actions,function(t,s){return i("q-icon",{key:s,staticClass:"cursor-pointer on-left",class:t.classes,attrs:{name:t.icon},nativeOn:{click:function(i){i.stopPropagation(),e.clickHandler(e.index,t.type,e.item)}}},[i("q-tooltip",[e._v(e._s(t.label))])],1)})):e._e(),e._l(e.cols,function(t,s){return i("span",{key:t.name+s,staticClass:"list__item",class:(a={},a["item_"+s]=!0,a),style:{color:e.item["x-flespi-filter-fields"]&&e.item["x-flespi-filter-fields"].includes(t.name)?"#4caf50":""},attrs:{title:e.values[t.name].value}},[e._v("\n    "+e._s(e.values[t.name].value)+"\n  ")]);var a}),e.etcVisible?i("span",{staticClass:"list__item item_etc"},[e._v("\n    "+e._s(e.values.etc.value||"*Empty*")+"\n  ")]):e._e()],2)])},h=[],u=i("lSNA"),p=i.n(u),g=i("cDf5"),f=i.n(g),v=(i("KKXr"),i("yt8O"),i("RW0V"),i("rGqo"),i("f3/d"),{props:["item","index","actions","cols","itemHeight","etcVisible","rowWidth","actionsVisible","selected"],data:function(){return{date:c["d"]}},computed:{values:function(){var e=this,t={};return t=this.cols.length?this.cols.reduce(function(e,t,i,s){return e[t.name]={value:null},i===s.length-1&&(e.etc={value:""}),e},{}):{etc:{value:""}},Object.keys(this.item).forEach(function(i){if(-1!==i.indexOf("#")){var s=i.split("#"),a=s[0],n=s[1];if(t[a]){if(t[a].value){if("object"!==f()(t[a].value)){var o=t[a].value;t[a].value=p()({},n-1,o)}}else t[a].value={};t[a].value[n]=JSON.stringify(e.item[i])}else t.etc.value+="".concat(i,": ").concat(JSON.stringify(e.item[i]),"; ")}else if(t[i]){var r=e.item[i];-1!==i.indexOf("timestamp")&&(r=c["d"].formatDate(1e3*r,"DD/MM/YYYY HH:mm:ss")),-1!==i.indexOf("image.bin.")&&(r="<binary image>"),t[i].value=JSON.stringify(r)}else{if("delimiter"===i||"__status"===i||"x-flespi-filter-fields"===i||"x-flespi-filter-next"===i||"x-flespi-filter-prev"===i)return!1;-1!==i.indexOf("image.bin.")?t.etc.value+="".concat(i,": <binary image>"):t.etc.value+="".concat(i,": ").concat(JSON.stringify(e.item[i]),"; ")}}),Object.keys(t).forEach(function(e){if("object"===f()(t[e].value)&&t[e].value)if(t[e].value instanceof Array){var i=t[e].value.reduce(function(e,t,i,s){return e+=t,i!==s.length-1&&(e+=", "),e},"");t[e].value=i}else if(t[e].value instanceof Object){var s=Object.keys(t[e].value).reduce(function(i,s,a,n){return i+="".concat(s,": ").concat(t[e].value[s]),a!==n.length-1&&(i+=", "),i},"");t[e].value=s}}),t}},methods:{clickHandler:function(e,t,i){this.$emit("action",{index:e,type:t,content:i})},itemClickHandler:function(e,t){this.$emit("item-click",{index:e,content:t})}}}),x=v,M=(i("ccs6"),i("KHd+")),w=Object(M["a"])(x,d,h,!1,null,null,null),z=w.exports,$={props:["mode","item","activeId","limit","config"],data:function(){return{theme:this.config.theme,i18n:{},viewConfig:this.config.viewConfig,actions:this.config.actions,moduleName:this.config.vuexModuleName}},computed:{messages:{get:function(){var e=this.$store.state[this.moduleName].messages;return this.setTranslate(e),e},set:function(e){this.$store.commit("".concat(this.moduleName,"/setMessages"),e)}},active:{get:function(){return this.$store.state[this.moduleName].active},set:function(){var e=o()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("".concat(this.moduleName,"/unsubscribePooling"));case 2:return this.$store.commit("".concat(this.moduleName,"/setActive"),t),this.$store.commit("".concat(this.moduleName,"/clearMessages")),e.next=6,this.$store.dispatch("".concat(this.moduleName,"/getCols"));case 6:if(0!==this.$store.state[this.moduleName].mode){e.next=11;break}return e.next=9,this.$store.dispatch("".concat(this.moduleName,"/initTime"));case 9:return e.next=11,this.$store.dispatch("".concat(this.moduleName,"/get"));case 11:if(this.$store.dispatch("".concat(this.moduleName,"/pollingGet")),1!==this.$store.state[this.moduleName].mode||this.item.deleted){e.next=15;break}return e.next=15,this.$store.dispatch("".concat(this.moduleName,"/getHistory"),200);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},cols:{get:function(){return this.$store.state[this.moduleName].cols},set:function(e){this.$store.commit("".concat(this.moduleName,"/updateCols"),e)}},filter:{get:function(){return this.$store.state[this.moduleName].filter},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setFilter"),e):this.$store.commit("".concat(this.moduleName,"/setFilter"),"")}},from:{get:function(){return this.$store.state[this.moduleName].from},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setFrom"),e):this.$store.commit("".concat(this.moduleName,"/setFrom"),0)}},to:{get:function(){return this.$store.state[this.moduleName].to},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setTo"),e):this.$store.commit("".concat(this.moduleName,"/setTo"),0)}},reverse:{get:function(){return this.$store.state[this.moduleName].reverse||!1},set:function(e){this.$store.commit("".concat(this.moduleName,"/setReverse"),e)}},currentLimit:{get:function(){return this.$store.state[this.moduleName].limit},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setLimit"),e):this.$store.commit("".concat(this.moduleName,"/setLimit"),1e3)}},selected:{get:function(){return this.$store.state[this.moduleName].selected},set:function(e){this.$store.commit("".concat(this.moduleName,"/setSelected"),e)}}},methods:{resetParams:function(){this.$refs.scrollList.resetParams()},filterChangeHandler:function(e){this.filter!==e&&(this.filter=e,0===this.mode&&(this.$store.commit("".concat(this.moduleName,"/clearMessages")),this.$store.dispatch("".concat(this.moduleName,"/get"))))},setTranslate:function(e){this.i18n.from=e.length?"Previous batch until ".concat(c["d"].formatDate(1e3*e[0].timestamp,"HH:mm:ss")):"Prev",this.i18n.to=e.length?"Next batch from ".concat(c["d"].formatDate(1e3*e[e.length-1].timestamp,"HH:mm:ss")):"Next"},modeChange:function(e){var t=this,i=null===this.$store.state[this.moduleName].mode;e=+e,this.$store.commit("".concat(this.moduleName,"/clearMessages")),1===e&&this.active&&null!==this.$store.state[this.moduleName].mode&&this.$store.dispatch("".concat(this.moduleName,"/getHistory"),200),this.$store.commit("".concat(this.moduleName,"/setMode"),e),0!==e||!this.active||this.item.deleted&&!i||this.$store.dispatch("".concat(this.moduleName,"/initTime")).then(function(){t.$store.dispatch("".concat(t.moduleName,"/get"))})},updateColsHandler:function(e){this.cols=e},dateChangeHandler:function(e){this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"setDate",payload:e})},datePrevChangeHandler:function(){this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"datePrev"})},dateNextChangeHandler:function(){this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"dateNext"})},paginationPrevChangeHandler:function(){var e=0;e=this.messages.length?1e3*this.messages[0].timestamp:0,this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"paginationPrev",payload:e})},paginationNextChangeHandler:function(){var e=0;e=this.messages.length?1e3*this.messages[this.messages.length-1].timestamp:0,this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"paginationNext",payload:e})},actionHandler:function(e){var t=e.index,i=e.type,s=e.content;switch(i){case"view":this.viewMessagesHandler({index:t,content:s});break;case"copy":this.copyMessageHandler({index:t,content:s});break}},viewMessagesHandler:function(e){var t=e.index,i=e.content;this.selected=t,this.$emit("view-data",i)},copyMessageHandler:function(e){var t=this,i=(e.index,e.content);this.$copyText(JSON.stringify(i)).then(function(e){t.$q.notify({type:"positive",icon:"content_copy",message:"Message copied",timeout:1e3})},function(e){t.$q.notify({type:"negative",icon:"content_copy",message:"Error coping messages",timeout:1e3})})},unselect:function(){this.selected&&(this.selected=null)}},watch:{activeId:function(e){this.active=e},mode:function(e){this.modeChange(e)},limit:function(e){this.currentLimit=e}},created:function(){var e=o()(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.$store.state[this.moduleName]?this.$store.commit("".concat(this.moduleName,"/clear")):this.$store.registerModule(this.moduleName,Object(r["c"])({Vue:l["default"],LocalStorage:this.$q.localStorage,name:this.moduleName,errorHandler:function(e){t.$store.commit("reqFailed",e)},filterHandler:this.filterMessages})),this.currentLimit=this.limit,!this.activeId){e.next=6;break}return this.$store.commit("".concat(this.moduleName,"/setActive"),this.activeId),e.next=6,this.$store.dispatch("".concat(this.moduleName,"/getCols"));case 6:if(null!==this.$store.state[this.moduleName].mode){e.next=12;break}if(this.modeChange(this.mode),this.$store.dispatch("".concat(this.moduleName,"/pollingGet")),1!==this.mode){e.next=12;break}return e.next=12,this.$store.dispatch("".concat(this.moduleName,"/getHistory"),200);case 12:l["default"].connector.socket.on("offline",function(){t.$store.commit("".concat(t.moduleName,"/setOffline"),1===t.mode),t.$store.commit("setSocketOffline",!0)}),l["default"].connector.socket.on("connect",function(){t.$store.state[t.moduleName].offline&&(t.$store.commit("".concat(t.moduleName,"/setReconnected"),1===t.mode),1===t.mode&&t.$store.dispatch("".concat(t.moduleName,"/getMissedMessages")),t.$store.commit("setSocketOffline",!1))});case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),destroyed:function(){l["default"].connector.socket.off("offline"),l["default"].connector.socket.off("connect"),this.$store.commit("".concat(this.moduleName,"/clear"))},mixins:[m["a"]],components:{VirtualScrollList:r["a"],MessagesListItem:z}},y=$,b=Object(M["a"])(y,s,a,!1,null,null,null);t["default"]=b.exports},uuwW:function(e,t,i){"use strict";var s=i("I6O0"),a=i.n(s);a.a}}]);